<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2023-12-02T06:45:28+01:00</updated><id>/feed.xml</id><title type="html">Niklas Nilsson</title><entry><title type="html">Next and previous buttons for active record</title><link href="/ruby/snippets/2023/12/02/next-and-previous-buttons-for-active-record.html" rel="alternate" type="text/html" title="Next and previous buttons for active record" /><published>2023-12-02T00:00:00+01:00</published><updated>2023-12-02T00:00:00+01:00</updated><id>/ruby/snippets/2023/12/02/next-and-previous-buttons-for-active-record</id><content type="html" xml:base="/ruby/snippets/2023/12/02/next-and-previous-buttons-for-active-record.html"><![CDATA[<p>Having buttons to go to the next or back out of an actice record is a desired function, for example, when creating a photo album. So how can one create this functionality in Rails?</p>

<p>Class:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="k">def</span> <span class="nf">next</span><span class="p">()</span>
    <span class="no">Photo</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"id &lt; ? AND user_id = ?"</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">id: :desc</span><span class="p">).</span><span class="nf">first</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">previous</span><span class="p">()</span>
    <span class="no">Photo</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"id &gt; ? AND user_id = ?"</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">id: :asc</span><span class="p">).</span><span class="nf">first</span>
  <span class="k">end</span></code></pre></figure>

<p><em>In my case this is in the photo class</em></p>

<p>View:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mb-auto"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;</span><span class="err">%</span> <span class="na">unless</span> <span class="err">@</span><span class="na">photo.previous.nil</span><span class="err">?</span> <span class="err">%</span><span class="nt">&gt;</span>
          <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">link_to</span> <span class="err">"</span><span class="na">Previous</span><span class="err">",</span>
            <span class="na">user_photo_url</span><span class="err">(</span><span class="na">user_username:</span> <span class="err">@</span><span class="na">photo.user.username_lower</span><span class="err">,</span> <span class="na">id:</span> <span class="err">@</span><span class="na">photo.previous.id</span><span class="err">),</span>
              <span class="na">class:</span> <span class="err">"</span><span class="na">btn</span> <span class="na">btn-dark</span> <span class="na">btn-lg</span> <span class="na">border-0</span><span class="err">",</span> <span class="err">"</span><span class="na">data-photo-target</span><span class="err">"</span><span class="na">:</span> <span class="err">"</span><span class="na">previous</span><span class="err">"</span> <span class="err">%</span><span class="nt">&gt;</span>
        <span class="nt">&lt;</span><span class="err">%</span> <span class="na">end</span> <span class="err">%</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span></code></pre></figure>

<p><em>This is from the view file</em></p>

<p>So by retrieving higher or lower than the id that we have currently uploaded, we get the next and earlier, in my case I have also added user_id to filter on which user uploaded. This could of course be a different filter or be missing altogether.</p>]]></content><author><name></name></author><category term="ruby" /><category term="snippets" /><category term="ruby" /><category term="rails" /><summary type="html"><![CDATA[Having buttons to go to the next or back out of an actice record is a desired function, for example, when creating a photo album. So how can one create this functionality in Rails?]]></summary></entry><entry><title type="html">Detect suspicious logins</title><link href="/security/2023/11/26/detect-suspicious-logins.html" rel="alternate" type="text/html" title="Detect suspicious logins" /><published>2023-11-26T00:00:00+01:00</published><updated>2023-11-26T00:00:00+01:00</updated><id>/security/2023/11/26/detect-suspicious-logins</id><content type="html" xml:base="/security/2023/11/26/detect-suspicious-logins.html"><![CDATA[<p>For the project im currently working on i wanted to add some additinal security by detecting suspicious logins, after a lot of ideas of looking on the geographical origin of the request i ended up in looking on the IP address, you would expect that you will get some possitive faults when a user uses a diffrent device to login - but i dont think this will be a verry common for more then 1-3 devices issue.</p>

<p>The action taken will be to send a mail to user asking <em>“was it you who signed in, otherwise please act”</em>.</p>

<h4 id="ruby-ipaddr">Ruby IPAddr</h4>
<p>IPAddr provides a set of methods to manipulate an IP address. Both IPv4 and IPv6 are supported. Using the ´mask(prefixlen)´ - witch returns a new ipaddr built by masking IP address with the given prefixlen/netmask. (e.g. 8, 64, “255.255.255.0”, etc.). This can then then be used to query the database of saved IP addresses if currrent ip mask exists. If not it is a considerd a new IP address and a suspicious login.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="n">ip_addr</span> <span class="o">=</span> <span class="no">IPAddr</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span>
  <span class="n">ip_addr</span><span class="p">.</span><span class="nf">mask</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span></code></pre></figure>]]></content><author><name></name></author><category term="security" /><category term="ruby" /><category term="rails" /><summary type="html"><![CDATA[For the project im currently working on i wanted to add some additinal security by detecting suspicious logins, after a lot of ideas of looking on the geographical origin of the request i ended up in looking on the IP address, you would expect that you will get some possitive faults when a user uses a diffrent device to login - but i dont think this will be a verry common for more then 1-3 devices issue.]]></summary></entry><entry><title type="html">Compressing HTML</title><link href="/snippet/2022/12/24/compressing-html.html" rel="alternate" type="text/html" title="Compressing HTML" /><published>2022-12-24T00:00:00+01:00</published><updated>2022-12-24T00:00:00+01:00</updated><id>/snippet/2022/12/24/compressing-html</id><content type="html" xml:base="/snippet/2022/12/24/compressing-html.html"><![CDATA[<p>Small snippet to compress HTML in Ruby. Returning from function is a string with the basic compressed HTML.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
  <span class="n">html</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="sr">/\n+/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
  <span class="n">html</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'  '</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
  <span class="n">html</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'&gt; &lt;'</span><span class="p">,</span> <span class="s1">'&gt;&lt;'</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">html</span>
<span class="k">end</span></code></pre></figure>]]></content><author><name></name></author><category term="snippet" /><category term="ruby" /><summary type="html"><![CDATA[Small snippet to compress HTML in Ruby. Returning from function is a string with the basic compressed HTML.]]></summary></entry><entry><title type="html">Publish a prebuilt jekyll project</title><link href="/jekyll/bash/ruby/2022/10/02/publish-a-prebuilt-jekyll-project.html" rel="alternate" type="text/html" title="Publish a prebuilt jekyll project" /><published>2022-10-02T00:00:00+02:00</published><updated>2022-10-02T00:00:00+02:00</updated><id>/jekyll/bash/ruby/2022/10/02/publish-a-prebuilt-jekyll-project</id><content type="html" xml:base="/jekyll/bash/ruby/2022/10/02/publish-a-prebuilt-jekyll-project.html"><![CDATA[<p>Jekyll and GitHub is a powerful combination, with easy you can publish a blog and the HTML will be built when you push. But you may run into issues when you use plugins that are not whitelisted by GitHub e.g the great archive gem.</p>

<p>The solution then is to build the HTML version locally and then push it to GitHub and make GitHub serve that as the webpage.</p>

<p>Im using a new branch <code class="language-plaintext highlighter-rouge">gh-pages</code> for this, beeing on master i run <code class="language-plaintext highlighter-rouge">jekyll build ~/temp_buil</code> and then i replace the content in the gh-pages branch with this. Then i publlish the branch gh-pages.</p>

<p>On GitHub go to settings, pages and select “deploy from branch” and set it to use the gh-pages branch.</p>

<p>You could turn this into a bash script.</p>]]></content><author><name></name></author><category term="jekyll" /><category term="bash" /><category term="ruby" /><category term="jekyll" /><category term="git" /><summary type="html"><![CDATA[Jekyll and GitHub is a powerful combination, with easy you can publish a blog and the HTML will be built when you push. But you may run into issues when you use plugins that are not whitelisted by GitHub e.g the great archive gem.]]></summary></entry><entry><title type="html">Overwrite local changes in Git</title><link href="/git/snippets/2021/12/21/overwrite-local-changes-in-git.html" rel="alternate" type="text/html" title="Overwrite local changes in Git" /><published>2021-12-21T00:00:00+01:00</published><updated>2021-12-21T00:00:00+01:00</updated><id>/git/snippets/2021/12/21/overwrite-local-changes-in-git</id><content type="html" xml:base="/git/snippets/2021/12/21/overwrite-local-changes-in-git.html"><![CDATA[<p>If tyou need to discard all local changes and just reset overwrite everything with a copy from the rmeote branch this is the way to do it. For me it was needed with the gh-pages branch of this project, depinding on what machine i last worked on the head would differ from computer to computer so i just need to update the head avoiding having to do a merge and fix a lot of meaningless conflicts.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>git fetch <span class="nt">--all</span>
  <span class="nv">$ </span>get reset <span class="nt">--hard</span> origin/branch
  <span class="nv">$ </span>git merge <span class="s1">'@{u}'</span></code></pre></figure>]]></content><author><name></name></author><category term="git" /><category term="snippets" /><category term="git" /><summary type="html"><![CDATA[If tyou need to discard all local changes and just reset overwrite everything with a copy from the rmeote branch this is the way to do it. For me it was needed with the gh-pages branch of this project, depinding on what machine i last worked on the head would differ from computer to computer so i just need to update the head avoiding having to do a merge and fix a lot of meaningless conflicts.]]></summary></entry></feed>